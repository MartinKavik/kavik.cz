---
// Learn about using Astro layouts:
// https://docs.astro.build/en/core-concepts/layouts/

import Footer from '../components/Footer.astro';
// Component Imports
import MainHead from '../components/MainHead.astro';
import Nav from '../components/Nav.astro';

interface Props {
	title?: string | undefined;
	description?: string | undefined;
}

const { title, description } = Astro.props;
---

<html lang="en">
	<head>
		<MainHead title={title} description={description} />
	</head>
	<body>
		<div class="stack backgrounds">
			<div class="floating-bricks" aria-hidden="true">
				<div class="brick brick-1"></div>
				<div class="brick brick-2"></div>
				<div class="brick brick-3"></div>
				<div class="brick brick-4"></div>
				<div class="brick brick-5"></div>
				<div class="brick brick-6"></div>
				<div class="brick brick-7"></div>
				<div class="brick brick-8"></div>
			</div>
			<Nav />
			<slot />
			<Footer />
		</div>

		<script>
			// Add "loaded" class once the document has completely loaded.
			addEventListener('load', () => document.documentElement.classList.add('loaded'));
		</script>

		<script>
			// Lightbox for portfolio images
			const expandIcon = `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
				<polyline points="15 3 21 3 21 9"></polyline>
				<polyline points="9 21 3 21 3 15"></polyline>
				<line x1="21" y1="3" x2="14" y2="10"></line>
				<line x1="3" y1="21" x2="10" y2="14"></line>
			</svg>`;

			// Create lightbox overlay
			const lightbox = document.createElement('div');
			lightbox.id = 'lightbox';
			lightbox.innerHTML = `
				<button class="lightbox-close" aria-label="Close">&times;</button>
				<img src="" alt="" />
			`;
			lightbox.style.cssText = `
				position: fixed;
				inset: 0;
				z-index: 9999;
				background: rgba(0, 0, 0, 0.9);
				display: none;
				align-items: center;
				justify-content: center;
				padding: 2rem;
			`;
			lightbox.style.cursor = '-webkit-zoom-out';
			lightbox.style.cursor = 'zoom-out';

			const closeBtn = lightbox.querySelector('.lightbox-close') as HTMLButtonElement;
			closeBtn.style.cssText = `
				position: absolute;
				top: 1rem;
				right: 1rem;
				width: 44px;
				height: 44px;
				background: transparent;
				border: none;
				color: white;
				font-size: 2rem;
				cursor: pointer;
				opacity: 0.7;
				transition: opacity 0.2s;
			`;
			closeBtn.addEventListener('mouseenter', () => closeBtn.style.opacity = '1');
			closeBtn.addEventListener('mouseleave', () => closeBtn.style.opacity = '0.7');

			const lbImg = lightbox.querySelector('img') as HTMLImageElement;
			lbImg.style.cssText = `
				max-width: 100%;
				max-height: 100%;
				object-fit: contain;
			`;
			lbImg.style.cursor = '-webkit-zoom-out';
			lbImg.style.cursor = 'zoom-out';

			const closeLightbox = () => {
				lightbox.style.display = 'none';
				document.body.style.overflow = '';
			};

			lightbox.addEventListener('click', closeLightbox);

			document.addEventListener('keydown', (e) => {
				if (e.key === 'Escape' && lightbox.style.display === 'flex') {
					closeLightbox();
				}
			});

			document.body.appendChild(lightbox);

			function openLightbox(imgSrc: string, imgAlt: string) {
				lbImg.src = imgSrc;
				lbImg.alt = imgAlt;
				lightbox.style.display = 'flex';
				document.body.style.overflow = 'hidden';
			}

			// Attach handlers to header images and their expand buttons
			document.querySelectorAll('.image-wrapper').forEach((wrapper) => {
				const img = wrapper.querySelector('img');
				const btn = wrapper.querySelector('.expand-btn');

				const open = (e: Event) => {
					e.stopPropagation();
					if (img) openLightbox((img as HTMLImageElement).src, (img as HTMLImageElement).alt);
				};

				img?.addEventListener('click', open);
				btn?.addEventListener('click', open);
			});

			// Add expand buttons to body images
			document.querySelectorAll('.body img').forEach((img) => {
				const wrapper = document.createElement('span');
				wrapper.className = 'body-img-wrapper';
				wrapper.style.cssText = 'position: relative; display: inline-block;';

				const btn = document.createElement('button');
				btn.className = 'expand-btn body-expand-btn';
				btn.setAttribute('aria-label', 'Enlarge image');
				btn.innerHTML = expandIcon;
				btn.style.cssText = `
					position: absolute;
					top: 0;
					right: 0;
					width: 32px;
					height: 32px;
					display: flex;
					align-items: center;
					justify-content: center;
					background: var(--gray-900);
					border: 1px solid var(--gray-700);
					border-radius: 0.5rem;
					color: var(--gray-300);
					cursor: pointer;
					opacity: 0.7;
					transition: opacity 0.2s, background 0.2s, color 0.2s;
				`;

				btn.addEventListener('mouseenter', () => { btn.style.opacity = '1'; btn.style.background = 'var(--gray-800)'; btn.style.color = 'var(--gray-0)'; });
				btn.addEventListener('mouseleave', () => { btn.style.opacity = '0.7'; btn.style.background = 'var(--gray-900)'; btn.style.color = 'var(--gray-300)'; });

				img.parentNode?.insertBefore(wrapper, img);
				wrapper.appendChild(img);
				wrapper.appendChild(btn);

				const open = () => openLightbox((img as HTMLImageElement).src, (img as HTMLImageElement).alt);
				img.addEventListener('click', open);
				btn.addEventListener('click', open);
			});
		</script>

		<style>
			:root {
				--_placeholder-bg: linear-gradient(transparent, transparent);
				--bg-image-main: url('/assets/backgrounds/bg-main-light-800w.jpg');
				--bg-image-main-curves: url('/assets/backgrounds/bg-main-light.svg');
				--bg-image-subtle-1: var(--_placeholder-bg);
				--bg-image-subtle-2: var(--_placeholder-bg);
				--bg-image-footer: var(--_placeholder-bg);
				--bg-svg-blend-mode: overlay;
				--bg-blend-mode: darken;
				--bg-image-aspect-ratio: 2.25;
				--bg-scale: 1.68;
				--bg-aspect-ratio: calc(var(--bg-image-aspect-ratio) / var(--bg-scale));
				--bg-gradient-size: calc(var(--bg-scale) * 100%);
			}

			:root.theme-dark {
				--bg-image-main: url('/assets/backgrounds/bg-main-dark-800w.jpg');
				--bg-image-main-curves: url('/assets/backgrounds/bg-main-dark.svg');
				--bg-svg-blend-mode: darken;
				--bg-blend-mode: lighten;
			}

			/* These backgrounds are displayed below the fold, so we lazy load them
			   once the `.loaded` class has been set.  */
			:root.loaded {
				--bg-image-subtle-1: url('/assets/backgrounds/bg-subtle-1-light-800w.jpg');
				--bg-image-subtle-2: url('/assets/backgrounds/bg-subtle-2-light-800w.jpg');
				--bg-image-footer: url('/assets/backgrounds/bg-footer-light-800w.jpg');
			}
			:root.loaded.theme-dark {
				--bg-image-subtle-1: url('/assets/backgrounds/bg-subtle-1-dark-800w.jpg');
				--bg-image-subtle-2: url('/assets/backgrounds/bg-subtle-2-dark-800w.jpg');
				--bg-image-footer: url('/assets/backgrounds/bg-footer-dark-800w.jpg');
			}

			@media (min-width: 50em) {
				:root {
					--bg-scale: 1;
					--bg-image-main: url('/assets/backgrounds/bg-main-light-1440w.jpg');
				}
				:root.theme-dark {
					--bg-image-main: url('/assets/backgrounds/bg-main-dark-1440w.jpg');
				}

				:root.loaded {
					--bg-image-subtle-1: url('/assets/backgrounds/bg-subtle-1-light-1440w.jpg');
					--bg-image-subtle-2: url('/assets/backgrounds/bg-subtle-2-light-1440w.jpg');
					--bg-image-footer: url('/assets/backgrounds/bg-footer-light-1440w.jpg');
				}
				:root.loaded.theme-dark {
					--bg-image-subtle-1: url('/assets/backgrounds/bg-subtle-1-dark-1440w.jpg');
					--bg-image-subtle-2: url('/assets/backgrounds/bg-subtle-2-dark-1440w.jpg');
					--bg-image-footer: url('/assets/backgrounds/bg-footer-dark-1440w.jpg');
				}
			}

			.backgrounds {
				min-height: 100%;
				isolation: isolate;
				background:
					/*grid*/
					var(--grid-pattern),
					/*base*/ var(--gray-999);
				background-size:
					/*grid*/ var(--grid-size) var(--grid-size),
					/*base*/ auto;
			}
			@media (forced-colors: active) {
				/* Deactivate custom backgrounds for high contrast users. */
				.backgrounds {
					background: none;
					background-blend-mode: none;
					--bg-gradient-size: none;
				}
			}

			/* Floating pixel bricks - small, animated */
			.floating-bricks {
				position: fixed;
				inset: 0;
				overflow: hidden;
				pointer-events: none;
				z-index: 1;
			}

			.brick {
				position: absolute;
				width: 12px;
				height: 12px;
				opacity: 0.12;
			}

			.brick-1 {
				background: #e63946;
				left: 5%;
				animation: float-up 25s linear infinite;
				animation-delay: -2s;
			}
			.brick-2 {
				background: #f4a261;
				left: 15%;
				animation: float-up 30s linear infinite;
				animation-delay: -8s;
			}
			.brick-3 {
				background: #e9c46a;
				left: 30%;
				animation: float-up 22s linear infinite;
				animation-delay: -5s;
			}
			.brick-4 {
				background: #2a9d8f;
				left: 45%;
				animation: float-up 28s linear infinite;
				animation-delay: -12s;
			}
			.brick-5 {
				background: #00b4d8;
				left: 60%;
				animation: float-up 26s linear infinite;
				animation-delay: -18s;
			}
			.brick-6 {
				background: #3a86ff;
				left: 75%;
				animation: float-up 32s linear infinite;
				animation-delay: -3s;
			}
			.brick-7 {
				background: #7209b7;
				left: 88%;
				animation: float-up 24s linear infinite;
				animation-delay: -15s;
			}
			.brick-8 {
				background: #f72585;
				left: 95%;
				animation: float-up 29s linear infinite;
				animation-delay: -22s;
			}

			@keyframes float-up {
				0% {
					transform: translateY(100vh) rotate(0deg);
				}
				100% {
					transform: translateY(-20vh) rotate(180deg);
				}
			}

			@media (prefers-reduced-motion: reduce) {
				.floating-bricks {
					display: none;
				}
			}

		</style>
	</body>
</html>

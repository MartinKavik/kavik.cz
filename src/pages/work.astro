---
import { getCollection } from 'astro:content';
import ContactCTA from '../components/ContactCTA.astro';
import Grid from '../components/Grid.astro';
import Hero from '../components/Hero.astro';
import PortfolioPreview from '../components/PortfolioPreview.astro';
import BaseLayout from '../layouts/BaseLayout.astro';
import EcosystemDiagram from '../components/EcosystemDiagram.astro';

const projects = (await getCollection('work')).sort(
	(a, b) => (a.data.sortOrder ?? 999) - (b.data.sortOrder ?? 999),
);
---

<BaseLayout
	title="Work | Martin Kavík"
	description="Rust, WebAssembly, and product design projects by Martin Kavík"
>
	<div class="stack gap-20">
		<main class="wrapper stack gap-8 page-content">
			<div class="deco-bricks" aria-hidden="true">
				<div class="deco-brick b1"></div>
				<div class="deco-brick b2"></div>
			</div>
			<Hero
				title="Work"
				tagline="Things I design & build."
				align="center"
			/>
			<section class="ecosystem-section">
				<p class="ecosystem-intro">Everything I build feeds into something else. Boon is the language. MoonZoon is the framework that powers its playground. NovyWave is built with MoonZoon. BoonComputer will run Boon on custom hardware. RayBox will render it all in 3D.</p>
				<EcosystemDiagram />
			</section>
			<Grid variant="offset-large">
				{
					projects.map((project) => (
						<li>
							<PortfolioPreview project={project} />
						</li>
					))
				}
			</Grid>
		</main>
		<ContactCTA />
	</div>
</BaseLayout>

<style>
	.page-content {
		position: relative;
	}

	.page-content :global(.hero) {
		margin-bottom: 3rem;
	}

	.deco-bricks {
		position: absolute;
		inset: 0;
		pointer-events: none;
		z-index: -1;
	}

	.deco-brick {
		position: absolute;
		opacity: 0.15;
	}

	.b1 {
		background: #3a86ff;
		width: 65px;
		height: 45px;
		left: 1%;
		top: 0.5rem;
	}

	.b2 {
		background: #e9c46a;
		width: 45px;
		height: 60px;
		right: 5%;
		top: 4rem;
	}

	@media (min-width: 50em) {
		.b1 {
			width: 95px;
			height: 60px;
		}

		.b2 {
			width: 65px;
			height: 80px;
		}
	}

	.ecosystem-section {
		display: flex;
		flex-direction: column;
		gap: 1.5rem;
		margin-bottom: 2rem;
	}

	.ecosystem-intro {
		max-width: 65ch;
		margin: 0 auto;
		text-align: center;
		color: var(--gray-300);
		font-size: var(--text-md);
	}
</style>

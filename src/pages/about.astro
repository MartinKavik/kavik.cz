---
import ContactCTA from '../components/ContactCTA.astro';
import Hero from '../components/Hero.astro';
import BaseLayout from '../layouts/BaseLayout.astro';
import VideoEmbed from '../components/VideoEmbed.astro';
import Gallery from '../components/Gallery.astro';
import Icon from '../components/Icon.astro';

const artworks = [
	{ src: "/images/about/blue_eye.jpg", alt: "Portrait", focus: "top" },
	{ src: "/images/about/mirror_boxer.jpg", alt: "Boxer" },
	{ src: "/images/about/puzzle_man.jpg", alt: "Puzzle man" },
	{ src: "/images/about/rain_girl.jpg", alt: "Rain" },
	{ src: "/images/about/running_man.jpg", alt: "Runner" },
	{ src: "/images/about/sunset_city.jpg", alt: "Sunset city" },
	{ src: "/images/about/dino_rainbow_combined.jpg", alt: "Rainbow dinosaur", title: "Rainbow Dino (feat. Victoria)", focus: "right" },
];
---

<BaseLayout title="About | Martin Kavík" description="Toolmaker. Explorer.">
	<div class="stack gap-20 lg:gap-32">
		<main class="wrapper about">
			<!-- Hero Section -->
			<div class="hero-container">
				<div class="deco-bricks" aria-hidden="true">
					<div class="deco-brick" style="background: #f4a261; width: 50px; height: 45px; left: 3%; top: 1rem;"></div>
					<div class="deco-brick" style="background: #7209b7; width: 45px; height: 55px; right: 4%; top: 3rem;"></div>
				</div>
				<Hero
					title="About Martin"
					tagline="Toolmaker. Explorer."
				>
					<button
						class="lightbox-trigger hero-img-btn"
						data-src="/images/martin_trondheim.jpg"
						data-alt="Martin Kavík in a forest near Trondheim"
						type="button"
						aria-label="View full image"
					>
						<img
							width="1200"
							height="800"
							src="/images/martin_trondheim.jpg"
							alt="Martin Kavík in a forest near Trondheim"
						/>
					</button>
				</Hero>
			</div>

			<!-- How I Work Section -->
			<section class="section">
				<div class="deco-bricks" aria-hidden="true">
					<div class="deco-brick" style="background: #3a86ff; width: 55px; height: 40px; left: 2%; top: 0;"></div>
				</div>
				<header class="section-header">
					<h2>How I Work</h2>
					<p>Every project feeds the next.</p>
				</header>
				<div class="section-content">
					<p>I wanted something different, so I built it. MoonZoon exists because existing frameworks felt wrong. Boon exists because MoonZoon wasn't enough. Eventually I ran out of software to fix — so I started on hardware.</p>
					<p>Remote work, one-on-one conversations, and flexible hours make me happy. Daily status meetings do not. I prefer depth over breadth, building over maintaining, and shipping over planning.</p>
				</div>
			</section>

			<!-- The Beginning Section -->
			<section class="section">
				<div class="deco-bricks" aria-hidden="true">
					<div class="deco-brick" style="background: #e9c46a; width: 60px; height: 50px; right: 3%; top: 0.5rem;"></div>
				</div>
				<header class="section-header">
					<h2>The Beginning</h2>
					<p>Coming full circle.</p>
				</header>
				<div class="section-content">
					<p>At thirteen, I built an antenna holder to finally get internet. Then I learned C# from a Czech school website. I faced a choice: pursue 3D graphics or programming.</p>
					<p>I chose programming — because tools let you make better things later. Now, with RayBox, I'm coming full circle to 3D graphics.</p>
				</div>
				<div class="video-grid">
					<div class="video-item">
						<VideoEmbed url="https://youtu.be/FAJVs5GcArQ" title="3D Kitchen Render (early work)" />
						<p class="video-caption">3D Kitchen, 2008</p>
					</div>
					<div class="video-item">
						<VideoEmbed url="https://youtu.be/Ics_QWPZATk" title="Case Modding (2009)" />
						<p class="video-caption">Case modding, 2009</p>
					</div>
				</div>
			</section>

			<!-- Creative Work Section -->
			<section class="section section-wide">
				<div class="deco-bricks" aria-hidden="true">
					<div class="deco-brick" style="background: #e63946; width: 50px; height: 45px; left: 5%; top: 0;"></div>
					<div class="deco-brick" style="background: #00b4d8; width: 40px; height: 55px; right: 6%; top: 1rem;"></div>
				</div>
				<header class="section-header">
					<h2>Drawings</h2>
					<p>Frustration driven, sustained by curiosity.</p>
				</header>
				<div class="section-content">
					<p>At fifteen, I had to move with my mum and sister to a rougher part of Ostrava city. The following seven years were an infinite loop: sleep at school → gym → programming → games or attempts at art.</p>
					<p>Drawing became my quiet escape — and a brutal teacher. When you create, the gaps expose what you don't know. No way to cheat.</p>
					<p>I slowly learned to struggle well and trust my decisions. Soon, I was able to help mum pay our rent from my first programming jobs — and my collection of drawings grew.</p>
				</div>
				<Gallery items={artworks} />
			</section>

			<!-- Music Section -->
			<section class="section">
				<div class="deco-bricks" aria-hidden="true">
					<div class="deco-brick" style="background: #2a9d8f; width: 45px; height: 50px; left: 1%; top: 0.5rem;"></div>
				</div>
				<header class="section-header">
					<h2>The Emptiness</h2>
					<p>A guitar composition.</p>
				</header>
				<div class="music-container">
					<div class="music-bg" aria-hidden="true"></div>
					<div class="section-content">
						<p>A piece I composed. My hands are too small to play it well, but it still makes me smile.</p>
					</div>
					<VideoEmbed url="https://youtu.be/3mNv0QXfPhE" title="The Emptiness - Guitar Composition by Martin Kavík" />
				</div>
			</section>

			<!-- Poetry Section -->
			<section class="section">
				<div class="deco-bricks" aria-hidden="true">
					<div class="deco-brick" style="background: #f72585; width: 50px; height: 40px; right: 2%; top: 0;"></div>
				</div>
				<header class="section-header">
					<h2>Poetry</h2>
					<p>Words and lines.</p>
				</header>
				<div class="poetry-layout">
					<button
						class="poetry-art-btn"
						data-src="/images/about/street.jpg"
						data-alt="Street drawing"
						type="button"
						aria-label="View full image"
					>
						<img
							src="/images/about/street.jpg"
							alt="Street drawing"
							class="poetry-art"
						/>
						<span class="expand-icon">
							<Icon icon="expand" size="1.25rem" />
						</span>
					</button>
					<blockquote>
						<p>Silhouette in the window<br>
						Watching street lamp in the moonlight<br>
						Holding the cup of cocoa<br>
						The clock's bell strikes the midnight<br>
						...</p>
					</blockquote>
				</div>
			</section>

			<!-- Hardware Detours Section -->
			<section class="section">
				<div class="deco-bricks" aria-hidden="true">
					<div class="deco-brick" style="background: #fb8500; width: 55px; height: 45px; left: 3%; top: 0;"></div>
					<div class="deco-brick" style="background: #8338ec; width: 40px; height: 50px; right: 4%; top: 1.5rem;"></div>
				</div>
				<header class="section-header">
					<h2>Hardware Detours</h2>
					<p>When code meets the physical world.</p>
				</header>
				<div class="hardware-grid">
					<div class="hardware-story">
						<button
							class="lightbox-trigger"
							data-src="/images/about/car_diagnostics.jpg"
							data-alt="Car diagnostics with laptop and OBD"
							type="button"
							aria-label="View full image"
						>
							<img src="/images/about/car_diagnostics.jpg" alt="Car diagnostics with laptop and OBD" />
						</button>
						<h3>Car Diagnostics</h3>
						<p>My car wouldn't start intermittently. I connected a laptop via OBD to hunt down the problem. Turned out to be an unreliable relay that was supposed to enable the fuel pump before starting — it would lose pressure and the engine couldn't fire.</p>
					</div>
					<div class="hardware-story">
						<button
							class="lightbox-trigger"
							data-src="/images/about/football_launcher_studio.jpg"
							data-alt="Football launcher studio setup"
							type="button"
							aria-label="View full image"
						>
							<img src="/images/about/football_launcher_studio.jpg" alt="Football launcher studio setup" />
						</button>
						<h3>Football Launcher</h3>
						<p>An ATTiny MCU controlled by a C# CLI app, connected through a PHP backend listening to the Facebook API. Users watched a live stream and picked where to shoot the ball at a real goalkeeper.</p>
					</div>
				</div>
				<p class="hardware-lesson">Both projects taught the same lesson: debugging unreliable relays and EMP from huge capacitors isn't something you want to do every day. I went back to software.</p>
			</section>

			<!-- Adventures Section -->
			<section class="section">
				<div class="deco-bricks" aria-hidden="true">
					<div class="deco-brick" style="background: #06d6a0; width: 50px; height: 55px; right: 2%; top: 0;"></div>
				</div>
				<header class="section-header">
					<h2>Adventures</h2>
					<p>Sometimes gravity wins.</p>
				</header>
				<div class="adventure-grid">
					<div class="adventure-item">
						<button
							class="lightbox-trigger"
							data-src="/images/about/bridge_jump.jpg"
							data-alt="Bridge jump"
							type="button"
							aria-label="View full image"
						>
							<img src="/images/about/bridge_jump.jpg" alt="Bridge jump" />
						</button>
						<p>Jumped off a bridge</p>
					</div>
					<div class="adventure-item">
						<button
							class="lightbox-trigger"
							data-src="/images/about/skydiving.jpg"
							data-alt="Skydiving"
							type="button"
							aria-label="View full image"
						>
							<img src="/images/about/skydiving.jpg" alt="Skydiving" />
						</button>
						<p>Jumped out of a plane</p>
					</div>
				</div>
			</section>

			<!-- Life Section -->
			<section class="section">
				<div class="deco-bricks" aria-hidden="true">
					<div class="deco-brick" style="background: #118ab2; width: 45px; height: 40px; left: 1%; top: 0.5rem;"></div>
				</div>
				<header class="section-header">
					<h2>Life</h2>
					<p>Prague, family, and future plans.</p>
				</header>
				<div class="section-content">
					<p>I live in Prague with my family. We enjoy spicy food, poppy seed strudels, smaller towns, and travel.</p>
					<p>I received a grant from NLnet Foundation to work on FastWave (now NovyWave) for a year. These days I lift toys more than weights.</p>
				</div>
				<div class="norway-grid">
					<div class="norway-item">
						<button
							class="lightbox-trigger"
							data-src="/images/about/cat_alesund.jpg"
							data-alt="Cat in Ålesund"
							type="button"
							aria-label="View full image"
						>
							<img src="/images/about/cat_alesund.jpg" alt="Cat in Ålesund" />
						</button>
						<p>Met a cat in Ålesund. Petting was mandatory.</p>
					</div>
					<div class="norway-item">
						<button
							class="lightbox-trigger"
							data-src="/images/about/norway_trip.jpg"
							data-alt="Norway road trip map"
							type="button"
							aria-label="View full image"
						>
							<img src="/images/about/norway_trip.jpg" alt="Norway road trip map" />
						</button>
						<p>No, we didn't stay (yet) — return tracking died.</p>
					</div>
				</div>
			</section>

		</main>

		<ContactCTA />
	</div>
</BaseLayout>

<style>
	/* Base layout */
	.about {
		display: flex;
		flex-direction: column;
		gap: 12rem;
	}

	@media (min-width: 50em) {
		.about {
			gap: 18rem;
		}
	}

	/* Decorative bricks */
	.deco-bricks {
		position: absolute;
		inset: 0;
		pointer-events: none;
		z-index: -1;
	}

	.deco-brick {
		position: absolute;
		opacity: 0.15;
	}

	@media (min-width: 50em) {
		.deco-brick {
			transform: scale(1.4);
		}
	}

	/* Hero container */
	.hero-container {
		position: relative;
	}

	.hero-container :global(.hero) img {
		margin-top: 1.5rem;
		border-radius: 1.5rem;
		box-shadow: var(--shadow-md);
		max-width: 800px;
		margin-left: auto;
		margin-right: auto;
	}

	/* Section base styles */
	.section {
		position: relative;
		display: flex;
		flex-direction: column;
		gap: 1.5rem;
		color: var(--gray-200);
	}

	.section-header {
		text-align: center;
		margin-bottom: 1rem;
	}

	.section-header h2 {
		font-size: var(--text-2xl);
		color: var(--gray-0);
		margin-bottom: 0.5rem;
	}

	.section-header p {
		font-size: var(--text-md);
		color: var(--gray-300);
	}

	@media (min-width: 50em) {
		.section-header {
			margin-bottom: 2rem;
		}

		.section-header h2 {
			font-size: var(--text-4xl);
		}

		.section-header p {
			font-size: var(--text-lg);
		}
	}

	/* Section content */
	.section-content {
		max-width: 65ch;
		margin: 0 auto;
		font-size: var(--text-md);
	}

	@media (min-width: 50em) {
		.section-content {
			font-size: var(--text-lg);
		}
	}

	.section-content p {
		margin-bottom: 1rem;
	}

	.section-content p:last-child {
		margin-bottom: 0;
	}

	.section-content a {
		text-decoration: 1px solid underline transparent;
		text-underline-offset: 0.25em;
		transition: text-decoration-color var(--theme-transition);
	}

	.section-content a:hover,
	.section-content a:focus {
		text-decoration-color: currentColor;
	}

	/* Wide sections (gallery) */
	.section-wide :global(.gallery) {
		width: 100vw;
		margin-left: calc(-50vw + 50%);
		margin-top: 2rem;
		padding: 0 1rem;
	}

	@media (min-width: 50em) {
		.section-wide :global(.gallery) {
			padding: 0 2rem;
		}
	}

	/* Video grid */
	.video-grid {
		display: grid;
		grid-template-columns: 1fr;
		gap: 1.5rem;
		margin-top: 2.5rem;
	}

	@media (min-width: 50em) {
		.video-grid {
			grid-template-columns: 1fr 1fr;
		}
	}

	.video-item {
		display: flex;
		flex-direction: column;
		gap: 0.5rem;
	}

	.video-caption {
		font-size: var(--text-md);
		color: var(--gray-400);
		text-align: center;
	}

	/* Music container */
	.music-container {
		position: relative;
		display: flex;
		flex-direction: column;
		gap: 1rem;
	}

	.music-bg {
		position: absolute;
		top: 0;
		left: calc(-50vw + 50%);
		width: 100vw;
		height: 100%;
		background-image: url('/images/about/emptiness_tab.jpg');
		background-size: cover;
		background-position: center top;
		background-repeat: no-repeat;
		opacity: 0.08;
		pointer-events: none;
	}

	:root:not(.theme-dark) .music-bg {
		filter: invert(1);
	}

	.music-container .section-content,
	.music-container :global(.video-embed) {
		position: relative;
	}

	.music-container :global(.video-embed) {
		max-width: 800px;
		margin: 2.5rem auto 0;
		padding-bottom: 0;
		height: auto;
		aspect-ratio: 16/9;
	}

	/* Poetry layout */
	.poetry-layout {
		display: flex;
		flex-direction: column;
		gap: 1.5rem;
		align-items: center;
	}

	.poetry-art-btn {
		position: relative;
		border: none;
		padding: 0;
		background: none;
		cursor: zoom-in;
		max-width: 350px;
		width: 100%;
	}

	.poetry-art {
		width: 100%;
		border-radius: 0.75rem;
		box-shadow: var(--shadow-md);
		display: block;
		transition: transform 0.2s ease, box-shadow 0.2s ease;
	}

	.poetry-art-btn:hover .poetry-art,
	.poetry-art-btn:focus .poetry-art {
		transform: scale(1.02);
		box-shadow: var(--shadow-lg);
	}

	.expand-icon {
		position: absolute;
		top: 0.75rem;
		right: 0.75rem;
		width: 36px;
		height: 36px;
		display: flex;
		align-items: center;
		justify-content: center;
		background: var(--gray-900);
		border: 1px solid var(--gray-700);
		border-radius: 0.5rem;
		color: var(--gray-300);
		opacity: 0.7;
		transition: opacity 0.2s, background 0.2s, color 0.2s;
	}

	.poetry-art-btn:hover .expand-icon,
	.poetry-art-btn:focus .expand-icon {
		opacity: 1;
		background: var(--gray-800);
		color: var(--gray-0);
	}

	.poetry-layout blockquote {
		font-style: italic;
		color: var(--gray-300);
		padding-left: 1.5rem;
		border-left: 3px solid var(--gray-700);
		margin: 0;
	}

	.poetry-layout blockquote p {
		line-height: 1.8;
	}

	@media (min-width: 50em) {
		.poetry-layout {
			flex-direction: row;
			justify-content: center;
			gap: 3rem;
		}

		.poetry-layout blockquote {
			text-align: left;
		}
	}

	/* Hardware grid */
	.hardware-grid {
		display: grid;
		grid-template-columns: 1fr;
		gap: 2rem;
	}

	@media (min-width: 50em) {
		.hardware-grid {
			grid-template-columns: 1fr 1fr;
		}
	}

	.hardware-story {
		display: flex;
		flex-direction: column;
		gap: 1rem;
	}

	.hardware-story img {
		width: 100%;
		border-radius: 1rem;
		box-shadow: var(--shadow-md);
		transition: transform 0.2s ease, box-shadow 0.2s ease;
	}

	.hardware-story h3 {
		font-size: var(--text-xl);
		color: var(--gray-0);
		margin-bottom: 0.25rem;
	}

	.hardware-story p {
		color: var(--gray-300);
		font-size: var(--text-md);
	}

	@media (min-width: 50em) {
		.hardware-story h3 {
			font-size: var(--text-2xl);
		}

		.hardware-story p {
			font-size: var(--text-lg);
		}
	}

	.hardware-lesson {
		color: var(--gray-400);
		font-style: italic;
		text-align: center;
		max-width: 65ch;
		margin: 0 auto;
		font-size: var(--text-md);
	}

	@media (min-width: 50em) {
		.hardware-lesson {
			font-size: var(--text-lg);
		}
	}

	/* Adventure grid */
	.adventure-grid {
		display: grid;
		grid-template-columns: 1fr 1fr;
		gap: 1.5rem;
	}

	.adventure-item {
		display: flex;
		flex-direction: column;
		gap: 0.5rem;
		text-align: center;
	}

	.adventure-item img {
		width: 100%;
		border-radius: 1rem;
		box-shadow: var(--shadow-md);
		aspect-ratio: 4 / 3;
		object-fit: cover;
		transition: transform 0.2s ease, box-shadow 0.2s ease;
	}

	.adventure-item p {
		font-size: var(--text-md);
		color: var(--gray-400);
	}

	@media (max-width: 600px) {
		.adventure-grid {
			grid-template-columns: 1fr;
		}
	}

	/* Norway grid */
	.norway-grid {
		display: grid;
		grid-template-columns: 1fr 1fr;
		gap: 2rem;
		max-width: 800px;
		margin: 2rem auto 0;
	}

	.norway-item {
		display: flex;
		flex-direction: column;
		gap: 0.5rem;
		text-align: center;
	}

	.norway-item img {
		width: 100%;
		border-radius: 1rem;
		box-shadow: var(--shadow-md);
		transition: transform 0.2s ease, box-shadow 0.2s ease;
	}

	.norway-item p {
		font-size: var(--text-md);
		color: var(--gray-300);
		font-style: italic;
	}

	@media (max-width: 500px) {
		.norway-grid {
			grid-template-columns: 1fr;
			max-width: 280px;
		}
	}

	/* Lightbox trigger buttons */
	.lightbox-trigger {
		display: block;
		border: none;
		padding: 0;
		background: none;
		cursor: zoom-in;
		width: 100%;
	}

	.lightbox-trigger img {
		transition: transform 0.2s ease, box-shadow 0.2s ease;
	}

	.lightbox-trigger:hover img,
	.lightbox-trigger:focus img {
		transform: scale(1.02);
		box-shadow: var(--shadow-lg);
	}

	.hero-img-btn img {
		width: 100%;
	}
</style>

<script>
	// Hook all lightbox triggers into the gallery lightbox
	const lightbox = document.getElementById('lightbox');
	const lightboxImg = document.getElementById('lightbox-img') as HTMLImageElement;
	const lightboxCaption = document.getElementById('lightbox-caption');

	// Get all lightbox trigger buttons (including poetry art button)
	const triggers = document.querySelectorAll('.lightbox-trigger, .poetry-art-btn');

	triggers.forEach((trigger) => {
		trigger.addEventListener('click', () => {
			const btn = trigger as HTMLElement;
			if (lightboxImg) {
				lightboxImg.src = btn.dataset.src || '';
				lightboxImg.alt = btn.dataset.alt || '';
			}
			if (lightboxCaption) {
				lightboxCaption.textContent = btn.dataset.title || '';
			}
			lightbox?.setAttribute('aria-hidden', 'false');
			document.body.style.overflow = 'hidden';
		});
	});
</script>

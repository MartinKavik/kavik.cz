---
import BaseLayout from '../layouts/BaseLayout.astro';
import Hero from '../components/Hero.astro';
import ContactCTA from '../components/ContactCTA.astro';
import ShelfSection from '../components/shelf/ShelfSection.astro';
import { bookCategories } from '../data/shelf-books';
import { gameCategories } from '../data/shelf-games';
---

<BaseLayout title="Shelf | Martin Kavík" description="Books and games that shaped my thinking.">
	<div class="stack gap-20 lg:gap-32">
		<main class="wrapper shelf">
			<div class="hero-container">
				<div class="deco-bricks" aria-hidden="true">
					<div class="deco-brick" style="background: #9b5de5; width: 50px; height: 45px; left: 3%; top: 1rem;"></div>
					<div class="deco-brick" style="background: #00f5d4; width: 40px; height: 50px; right: 4%; top: 2rem;"></div>
				</div>
				<Hero
					title="Shelf"
					tagline="Books and games that shaped my thinking."
				/>
			</div>

			<!-- Blog Link -->
			<section class="intro-section">
				<a href="/blog/the-boon-of-dataflow" class="blog-link">
					<span class="blog-link-label">Blog post</span>
					<span class="blog-link-title">The Boon of Dataflow</span>
					<span class="blog-link-arrow">→</span>
				</a>
			</section>

			<ShelfSection
				title="Books"
				categories={bookCategories}
				counterPrefix="B"
				sectionClass="books-section"
			/>

			<ShelfSection
				title="Games"
				categories={gameCategories}
				counterPrefix="G"
				sectionClass="games-section"
			/>
		</main>

		<ContactCTA />
	</div>
</BaseLayout>

<style>
	.shelf {
		display: flex;
		flex-direction: column;
		gap: 5rem;
	}

	.hero-container {
		position: relative;
	}

	.deco-bricks {
		position: absolute;
		inset: 0;
		pointer-events: none;
		z-index: -1;
	}

	.deco-brick {
		position: absolute;
		opacity: 0.15;
	}

	@media (min-width: 50em) {
		.deco-brick {
			transform: scale(1.4);
		}
	}

	/* Blog link section */
	.intro-section {
		display: flex;
		justify-content: center;
	}

	.blog-link {
		display: inline-flex;
		align-items: center;
		gap: 0.5rem;
		padding: 0.75rem 1.25rem;
		background: var(--gradient-subtle);
		border: 1px solid var(--gray-800);
		border-radius: 999px;
		text-decoration: none;
		transition: border-color var(--theme-transition), box-shadow var(--theme-transition), transform 0.2s ease;
	}

	.blog-link:hover {
		border-color: var(--gray-600);
		box-shadow: var(--shadow-sm);
		transform: translateY(-2px);
	}

	.blog-link-title {
		font-size: var(--text-md);
		color: var(--gray-0);
		font-weight: 500;
	}

	.blog-link-arrow {
		font-size: var(--text-lg);
		color: var(--accent-regular);
		transition: transform 0.2s ease;
	}

	.blog-link:hover .blog-link-arrow {
		transform: translateX(4px);
	}

	@media (min-width: 50em) {
		.blog-link {
			padding: 1rem 1.5rem;
			gap: 0.75rem;
		}

		.blog-link-title {
			font-size: var(--text-lg);
		}
	}
</style>

<script>
	function initShelfLinks() {
		// Handle hash navigation on page load
		const hash = window.location.hash.slice(1);
		if (hash) {
			const target = document.getElementById(hash);
			if (target?.tagName === 'LI') {
				setTimeout(() => {
					target.scrollIntoView({ behavior: 'smooth', block: 'center' });
					target.classList.add('highlighted');
					target.addEventListener('animationend', () => {
						target.classList.remove('highlighted');
					}, { once: true });
				}, 100);
			}
		}

		// Handle counter clicks to copy links
		document.querySelectorAll('.counter-label').forEach(btn => {
			btn.addEventListener('click', async (e) => {
				e.preventDefault();
				const id = (btn as HTMLElement).dataset.id;
				const url = `${window.location.origin}${window.location.pathname}#${id}`;

				try {
					await navigator.clipboard.writeText(url);
					btn.classList.add('copied');
					setTimeout(() => btn.classList.remove('copied'), 1500);
				} catch {
					const textArea = document.createElement('textarea');
					textArea.value = url;
					document.body.appendChild(textArea);
					textArea.select();
					document.execCommand('copy');
					document.body.removeChild(textArea);
					btn.classList.add('copied');
					setTimeout(() => btn.classList.remove('copied'), 1500);
				}
			});
		});
	}

	initShelfLinks();
	document.addEventListener('astro:page-load', initShelfLinks);
</script>

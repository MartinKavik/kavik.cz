---
import BaseLayout from '../layouts/BaseLayout.astro';
import Hero from '../components/Hero.astro';
import ContactCTA from '../components/ContactCTA.astro';
import ShelfSection from '../components/shelf/ShelfSection.astro';
import { bookCategories } from '../data/shelf-books';
import { gameCategories } from '../data/shelf-games';
---

<BaseLayout title="Shelf | Martin Kavík" description="Books and games that shaped my thinking.">
	<div class="stack gap-20 lg:gap-32">
		<main class="wrapper shelf">
			<div class="hero-container">
				<div class="deco-bricks" aria-hidden="true">
					<div class="deco-brick" style="background: #9b5de5; width: 50px; height: 45px; left: 3%; top: 1rem;"></div>
					<div class="deco-brick" style="background: #00f5d4; width: 40px; height: 50px; right: 4%; top: 2rem;"></div>
				</div>
				<Hero
					title="Shelf"
					tagline="Books and games that shaped my thinking."
				/>
			</div>

			<!-- Themes Section -->
			<section class="themes-section">
				<p class="themes-intro">
					These aren't random picks. The same ideas keep surfacing — in the books I reach for, the games I remember, and the <a href="/work">tools I build</a>.
				</p>

				<div class="themes-grid">
					<div class="theme">
						<h3>Time & Dataflow</h3>
						<p>Time as a first-class concept in <em>Lucid</em>. Time as a puzzle in <em>Braid</em>. Boon's runtime that remembers values across reloads. MoonZoon's signals reacting to change. <em>Factorio</em> where the factory IS the dataflow program. Programs as data pipelines flowing through time.</p>
					</div>

					<div class="theme">
						<h3>Consciousness & Identity</h3>
						<p><em>Detroit: Become Human</em> asking what makes us human. <em>SOMA</em> questioning if copied minds are still "you." <em>Hellblade</em> rendering psychosis as gameplay. <em>Thinking, Fast and Slow</em> revealing how the mind fools itself. Prompter watching AI think. The question runs through everything.</p>
					</div>

					<div class="theme">
						<h3>Visual Beauty</h3>
						<p><em>GRIS</em> painting grief in watercolor. <em>Ori</em> as beauty in motion. <em>Gorogoa</em> hand-drawn with obsessive care. <em>Refactoring UI</em> teaching design taste. RayBox using SDF and PBR for 3D interfaces. Boon's visual debugger inspired by <em>Factorio</em>. Beauty matters.</p>
					</div>

					<div class="theme">
						<h3>Worlds Within Worlds</h3>
						<p><em>COCOON</em> — worlds inside orbs inside worlds. <em>Portal</em> folding space. <em>Inscryption</em> as games within games. BoonComputer: Boon describing hardware that runs Boon. The deepest kind of recursion — systems containing themselves.</p>
					</div>

					<div class="theme">
						<h3>Teaching Simply</h3>
						<p><em>Computer Engineering for Babies</em> explains logic gates with colors. <em>Portal</em> teaches physics through play. Boon makes programming simpler. MoonZoon removes HTML, CSS, and JavaScript. The best tools hide complexity, not expose it.</p>
					</div>

					<div class="theme">
						<h3>Escaping Constraints</h3>
						<p><em>The 100-Year-Old Man</em> escaping a nursing home. <em>elm-ui</em> escaping CSS. <em>Rework</em> giving permission to stay small. MoonZoon escaping the frontend mess. RayBox escaping flat 2D. Boon escaping state management. Breaking free from what doesn't work.</p>
					</div>

					<div class="theme">
						<h3>Becoming Better</h3>
						<p>Kratos learning to be a father in <em>God of War</em>. Senua confronting her demons in <em>Hellblade</em>. <em>Way of the Peaceful Warrior</em> on spiritual growth. MoonZoon's evolution through years of iteration. The whole portfolio is self-improvement — building skills project by project.</p>
					</div>

					<div class="theme">
						<h3>Bonds & Relationships</h3>
						<p>Kratos and Atreus. Amicia protecting Hugo in <em>A Plague Tale</em>. Geralt and Ciri. <em>It Takes Two</em> saving a marriage through cooperation. My projects form a family tree too — MoonZoon birthed from Seed, NovyWave built with MoonZoon, BoonComputer as Boon's hardware child.</p>
					</div>

					<div class="theme theme-wide">
						<h3>Descent & Return</h3>
						<p><em>Hellblade</em> descending into Hel. <em>Ori</em> through dark forests toward light. <em>The Egyptian</em> and Sinuhe's exile. The MoonZoon history documents the frustration phase — Virtual DOM hell, failed experiments, dead ends. Each descent taught something. BoonComputer is the current descent: "run Boon on a CPU designed in Boon." The hero's journey pattern — escape the boring life, descend into struggle, return stronger, share what you learned.</p>
					</div>
				</div>
			</section>

			<ShelfSection
				title="Books"
				categories={bookCategories}
				counterPrefix="B"
				sectionClass="books-section"
			/>

			<ShelfSection
				title="Games"
				categories={gameCategories}
				counterPrefix="G"
				sectionClass="games-section"
			/>
		</main>

		<ContactCTA />
	</div>
</BaseLayout>

<style>
	.shelf {
		display: flex;
		flex-direction: column;
		gap: 5rem;
	}

	.hero-container {
		position: relative;
	}

	.deco-bricks {
		position: absolute;
		inset: 0;
		pointer-events: none;
		z-index: -1;
	}

	.deco-brick {
		position: absolute;
		opacity: 0.15;
	}

	@media (min-width: 50em) {
		.deco-brick {
			transform: scale(1.4);
		}
	}

	/* Themes section */
	.themes-section {
		display: flex;
		flex-direction: column;
		gap: 2rem;
	}

	.themes-intro {
		font-size: var(--text-lg);
		color: var(--gray-200);
		text-align: center;
		max-width: 50ch;
		margin: 0 auto;
		line-height: 1.6;
	}

	.themes-intro a {
		color: var(--gray-0);
		text-decoration: underline;
		text-decoration-color: var(--gray-600);
		text-underline-offset: 0.2em;
		transition: text-decoration-color var(--theme-transition);
	}

	.themes-intro a:hover {
		text-decoration-color: currentColor;
	}

	.themes-grid {
		display: grid;
		grid-template-columns: 1fr;
		gap: 1.5rem;
	}

	@media (min-width: 50em) {
		.themes-grid {
			grid-template-columns: 1fr 1fr;
			gap: 2rem;
		}
	}

	@media (min-width: 75em) {
		.themes-grid {
			grid-template-columns: 1fr 1fr 1fr;
		}
	}

	.theme {
		background: var(--gradient-subtle);
		border: 1px solid var(--gray-800);
		border-radius: 1rem;
		padding: 1.5rem;
		transition: border-color var(--theme-transition), box-shadow var(--theme-transition);
	}

	.theme:hover {
		border-color: var(--gray-700);
		box-shadow: var(--shadow-sm);
	}

	.theme h3 {
		font-size: var(--text-lg);
		color: var(--gray-0);
		margin-bottom: 0.75rem;
	}

	.theme p {
		font-size: var(--text-sm);
		color: var(--gray-300);
		line-height: 1.65;
	}

	.theme em {
		color: var(--gray-200);
		font-style: normal;
	}

	.theme-wide {
		grid-column: 1 / -1;
	}

	@media (min-width: 50em) {
		.themes-intro {
			font-size: var(--text-xl);
		}

		.theme h3 {
			font-size: var(--text-xl);
		}

		.theme p {
			font-size: var(--text-md);
		}
	}
</style>

<script>
	function initShelfLinks() {
		// Handle hash navigation on page load
		const hash = window.location.hash.slice(1);
		if (hash) {
			const target = document.getElementById(hash);
			if (target?.tagName === 'LI') {
				setTimeout(() => {
					target.scrollIntoView({ behavior: 'smooth', block: 'center' });
					target.classList.add('highlighted');
					target.addEventListener('animationend', () => {
						target.classList.remove('highlighted');
					}, { once: true });
				}, 100);
			}
		}

		// Handle counter clicks to copy links
		document.querySelectorAll('.counter-label').forEach(btn => {
			btn.addEventListener('click', async (e) => {
				e.preventDefault();
				const id = (btn as HTMLElement).dataset.id;
				const url = `${window.location.origin}${window.location.pathname}#${id}`;

				try {
					await navigator.clipboard.writeText(url);
					btn.classList.add('copied');
					setTimeout(() => btn.classList.remove('copied'), 1500);
				} catch {
					const textArea = document.createElement('textarea');
					textArea.value = url;
					document.body.appendChild(textArea);
					textArea.select();
					document.execCommand('copy');
					document.body.removeChild(textArea);
					btn.classList.add('copied');
					setTimeout(() => btn.classList.remove('copied'), 1500);
				}
			});
		});
	}

	initShelfLinks();
	document.addEventListener('astro:page-load', initShelfLinks);
</script>
